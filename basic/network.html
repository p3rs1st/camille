<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机网络 | Never See</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="不见">
    
    <link rel="preload" href="/camille/assets/css/0.styles.ac02bd7f.css" as="style"><link rel="preload" href="/camille/assets/js/app.89cf657d.js" as="script"><link rel="preload" href="/camille/assets/js/2.c0d8e570.js" as="script"><link rel="preload" href="/camille/assets/js/1.b1971c90.js" as="script"><link rel="preload" href="/camille/assets/js/26.a28b8735.js" as="script"><link rel="prefetch" href="/camille/assets/js/10.655a1089.js"><link rel="prefetch" href="/camille/assets/js/11.e879aba2.js"><link rel="prefetch" href="/camille/assets/js/12.3d71d70f.js"><link rel="prefetch" href="/camille/assets/js/13.b40e96b9.js"><link rel="prefetch" href="/camille/assets/js/14.a15c23f8.js"><link rel="prefetch" href="/camille/assets/js/15.086621a3.js"><link rel="prefetch" href="/camille/assets/js/16.38ad00d8.js"><link rel="prefetch" href="/camille/assets/js/17.7d9f6541.js"><link rel="prefetch" href="/camille/assets/js/18.58f20acb.js"><link rel="prefetch" href="/camille/assets/js/19.cf2cf075.js"><link rel="prefetch" href="/camille/assets/js/20.f36b6fbb.js"><link rel="prefetch" href="/camille/assets/js/21.d1e109e6.js"><link rel="prefetch" href="/camille/assets/js/22.e5e7d61e.js"><link rel="prefetch" href="/camille/assets/js/23.c0b72d40.js"><link rel="prefetch" href="/camille/assets/js/24.24755f5b.js"><link rel="prefetch" href="/camille/assets/js/25.e79f3b27.js"><link rel="prefetch" href="/camille/assets/js/27.2019210c.js"><link rel="prefetch" href="/camille/assets/js/28.195e9507.js"><link rel="prefetch" href="/camille/assets/js/29.da9a1b36.js"><link rel="prefetch" href="/camille/assets/js/3.c9a6670a.js"><link rel="prefetch" href="/camille/assets/js/30.7e78e35a.js"><link rel="prefetch" href="/camille/assets/js/31.742a34b1.js"><link rel="prefetch" href="/camille/assets/js/32.c69a703e.js"><link rel="prefetch" href="/camille/assets/js/33.9a798fe0.js"><link rel="prefetch" href="/camille/assets/js/34.09ed62b4.js"><link rel="prefetch" href="/camille/assets/js/35.40c45f3a.js"><link rel="prefetch" href="/camille/assets/js/36.30460db4.js"><link rel="prefetch" href="/camille/assets/js/37.36129612.js"><link rel="prefetch" href="/camille/assets/js/38.84775c59.js"><link rel="prefetch" href="/camille/assets/js/39.233eb667.js"><link rel="prefetch" href="/camille/assets/js/4.51108671.js"><link rel="prefetch" href="/camille/assets/js/40.665ccab0.js"><link rel="prefetch" href="/camille/assets/js/41.8f5e492c.js"><link rel="prefetch" href="/camille/assets/js/42.bc9f0e34.js"><link rel="prefetch" href="/camille/assets/js/43.203e2859.js"><link rel="prefetch" href="/camille/assets/js/44.d6e345f5.js"><link rel="prefetch" href="/camille/assets/js/5.c5132282.js"><link rel="prefetch" href="/camille/assets/js/6.89d8cb10.js"><link rel="prefetch" href="/camille/assets/js/7.ee093510.js"><link rel="prefetch" href="/camille/assets/js/vendors~docsearch.3d49b2ab.js">
    <link rel="stylesheet" href="/camille/assets/css/0.styles.ac02bd7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/camille/" class="home-link router-link-active"><!----> <span class="site-name">Never See</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/camille/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/camille/always/network.html" class="nav-link">
  常用表
</a></div><div class="nav-item"><a href="/camille/basic/network.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  基础知识
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          理论知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/theory/basic/basic.html" class="nav-link">
  基础理论
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/multi_process/basic.html" class="nav-link">
  多进程
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/jvm/basic.html" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringBoot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/springboot/bug.html" class="nav-link">
  bugs
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/framework/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/camille/framework/dubbo/" class="nav-link">
  Dubbo
</a></li></ul></div></div><div class="nav-item"><a href="/camille/unorganized/" class="nav-link">
  待整理
</a></div><div class="nav-item"><a href="/camille/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/camille/system/" class="nav-link">
  系统安装
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/camille/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/camille/always/network.html" class="nav-link">
  常用表
</a></div><div class="nav-item"><a href="/camille/basic/network.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  基础知识
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          理论知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/theory/basic/basic.html" class="nav-link">
  基础理论
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/multi_process/basic.html" class="nav-link">
  多进程
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/jvm/basic.html" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringBoot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/springboot/bug.html" class="nav-link">
  bugs
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/framework/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/camille/framework/dubbo/" class="nav-link">
  Dubbo
</a></li></ul></div></div><div class="nav-item"><a href="/camille/unorganized/" class="nav-link">
  待整理
</a></div><div class="nav-item"><a href="/camille/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/camille/system/" class="nav-link">
  系统安装
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/camille/basic/network.html" aria-current="page" class="active sidebar-link">计算机网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/camille/basic/network.html#osi7" class="sidebar-link">OSI7</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#集线器-交换机-路由器" class="sidebar-link">集线器, 交换机, 路由器</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#电路交换-报文交换-分组交换" class="sidebar-link">电路交换, 报文交换, 分组交换</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#rpc" class="sidebar-link">RPC</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#dns" class="sidebar-link">DNS</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#ip" class="sidebar-link">IP</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#tcp" class="sidebar-link">TCP</a></li><li class="sidebar-sub-header"><a href="/camille/basic/network.html#udp" class="sidebar-link">UDP</a></li></ul></li><li><a href="/camille/basic/theory.html" class="sidebar-link">理论</a></li><li><a href="/camille/basic/definition.html" class="sidebar-link">定义</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="计算机网络"><a href="#计算机网络" class="header-anchor">#</a> 计算机网络</h1> <p></p><div class="table-of-contents"><ul><li><a href="#osi7">OSI7</a></li><li><a href="#集线器-交换机-路由器">集线器, 交换机, 路由器</a></li><li><a href="#电路交换-报文交换-分组交换">电路交换, 报文交换, 分组交换</a></li><li><a href="#rpc">RPC</a></li><li><a href="#http">HTTP</a><ul><li><a href="#报文结构">报文结构</a></li><li><a href="#通信数据转发">通信数据转发</a></li><li><a href="#https">HTTPS</a></li><li><a href="#http-1-0-vs-http-1-1">HTTP/1.0 VS HTTP/1.1</a></li><li><a href="#http-2-0">HTTP/2.0</a></li></ul></li><li><a href="#dns">DNS</a><ul><li><a href="#简介">简介</a></li><li><a href="#域名服务器">域名服务器</a></li><li><a href="#dns解析过程">DNS解析过程</a></li><li><a href="#dns安全">DNS安全</a></li></ul></li><li><a href="#ip">IP</a><ul><li><a href="#数据包格式">数据包格式</a></li><li><a href="#ip地址编码">IP地址编码</a></li><li><a href="#相关协议">相关协议</a></li><li><a href="#网络地址转换nat">网络地址转换NAT</a></li><li><a href="#ipv6">IPV6</a></li></ul></li><li><a href="#tcp">TCP</a><ul><li><a href="#三次握手四次挥手">三次握手四次挥手</a></li><li><a href="#状态机">状态机</a></li><li><a href="#一些情况">一些情况</a></li><li><a href="#tcp重传">TCP重传</a></li><li><a href="#rtt">RTT</a></li><li><a href="#tcp滑动窗口">TCP滑动窗口</a></li></ul></li><li><a href="#udp">UDP</a></li></ul></div><p></p> <h2 id="osi7"><a href="#osi7" class="header-anchor">#</a> OSI7</h2> <blockquote><p>物理层 → 数据链路层 → 网络层 →
传输层 → 会话层 → 表示层 → 应用层</p></blockquote> <p><code>物理层</code>: 提供物理连接, 透明的比特流传输</p> <p><code>数据链路层</code>: 通过控制协议, 将物理信道转为可靠的数据链路</p> <ul><li>MAC介质访问控制层: 解决共享网络中多用户对信道竞争的问题</li> <li>LLC逻辑链路控制层: 建立维护网络连接, 差错校验</li></ul> <p><code>网络层</code>: 通过路由选择算法, 完成寻址, 交换, 路由, 网络层协议ip</p> <p><code>传输层</code>: 差错和流量控制, 保证数据传输的可靠性，传输层协议TCP, UDP</p> <p><code>会话层</code>: 协调两会话进程通信, 管理数据交互</p> <p><code>表示层</code>: 处理数据格式, 数据编码, 压缩解压缩, 数据加密解密</p> <p><code>应用层</code>: 向用户提供网络服务接口, 应用层协议FTP, HTTP</p> <p><strong>TCP/IP分层</strong>: 网络接口层, 网间层, 传输层, 应用层</p> <h2 id="集线器-交换机-路由器"><a href="#集线器-交换机-路由器" class="header-anchor">#</a> 集线器, 交换机, 路由器</h2> <p><code>集线器</code>: 物理层, 数据广播到所有端口, 总线拓扑, 共用带宽</p> <p><code>交换机</code>: 数据链路层, 根据MAC地址转发, 独享带宽, 同一网段通信</p> <p><code>路由器</code>: 网络层, 根据ip地址转发, 防火墙, 不同网段通信</p> <h2 id="电路交换-报文交换-分组交换"><a href="#电路交换-报文交换-分组交换" class="header-anchor">#</a> 电路交换, 报文交换, 分组交换</h2> <p><code>电路交换</code>: 建立通信独占信道, 独占带宽</p> <p><code>报文交换</code>: 以报文为数据单位交换, 存储转发, 报文长度差异导致时延大</p> <p><code>分组交换</code>: 将数据分组传输, 存储转发</p> <h2 id="rpc"><a href="#rpc" class="header-anchor">#</a> RPC</h2> <blockquote><p>RPC: Remote Procedure Call, 远程过程调用</p></blockquote> <ul><li>采用客户端/服务端模式</li> <li>RPC协议: 客户端调用接口, 传入参数, 通过client sub将参数序列化为消息发送给服务端, 服务端接受消息通过server sub反序列化为参数, 调用服务端过程, 最后相同步骤返回给客户端</li> <li>RPC框架: Dubbo, SpringCloud</li> <li>通信协议: 可使用HTTP或TCP</li> <li>序列化技术: Jackson, JSON, Hessian</li></ul> <h2 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h2> <h3 id="报文结构"><a href="#报文结构" class="header-anchor">#</a> 报文结构</h3> <p><strong>请求报文</strong>:</p> <ul><li><code>请求行</code>: 请求方法, URL, 协议版本</li> <li><code>请求头部</code>: (一行一对)头部字段名-值</li> <li><code>空行</code></li> <li><code>请求包体</code>: 用于POST</li></ul> <p><strong>响应报文</strong>:</p> <ul><li><code>状态行</code>: 协议版本, 状态码, 状态码描述</li> <li><code>响应头部</code>: (一行一对)头部字段名-值</li> <li><code>空行</code></li> <li><code>响应包体</code>: 响应内容</li></ul> <h3 id="通信数据转发"><a href="#通信数据转发" class="header-anchor">#</a> 通信数据转发</h3> <ul><li>代理: 接受客户端请求, 转发给其他服务器
<ul><li>正向代理: 通过代理服务器访问原始服务器资源(例如无法直接访问的服务器), 客户端知道代理服务器</li> <li>反向代理: 代理服务器接受网络请求, 转发给内部服务器, 客户端不知道是代理服务前正在代理</li></ul></li> <li>网关: 将HTTP转化为其他协议通信</li> <li>隧道: 使用SSL等加密手段, 建立安全通信线路</li></ul> <h3 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h3> <h4 id="加密"><a href="#加密" class="header-anchor">#</a> 加密</h4> <ol><li>客户端向服务端获取服务端公钥</li> <li>客户端生成一个对称密钥, 通过公钥加密后发给服务端</li> <li>服务端使用公钥对应的私钥解密出对称密钥</li> <li>之后的通信使用密钥进行加密</li></ol> <h4 id="认证"><a href="#认证" class="header-anchor">#</a> 认证</h4> <p>通过使用证书对通信方进行认证</p> <ol><li>服务器向CA(数字证书认证机构, 可信赖的第三方)申请公钥</li> <li>CA对申请的公钥做数字签名, 将公钥放入公钥证书绑定</li> <li>HTTPS通信时, 服务器发送证书给客户端, 客户端获得其中的公钥以及数字签名, 验证数字签名后通信</li></ol> <h4 id="完整性保护"><a href="#完整性保护" class="header-anchor">#</a> 完整性保护</h4> <p>SSL提供MD5报文摘要进行完整性保护</p> <h3 id="http-1-0-vs-http-1-1"><a href="#http-1-0-vs-http-1-1" class="header-anchor">#</a> HTTP/1.0 VS HTTP/1.1</h3> <p>HTTP/1.1默认长连接, 支持同时多个TCP连接, 新增状态码100, 支持分块传输编码, 新增缓存处理命令</p> <h3 id="http-2-0"><a href="#http-2-0" class="header-anchor">#</a> HTTP/2.0</h3> <ul><li><code>二进制分帧层</code>: 将报文分为HEADERS帧和DATA帧, 帧可交错发送, 消息是一系列帧的组装</li> <li><code>服务端推送</code>: 客户端请求一个资源时, 同时返回相关资源</li> <li><code>首部压缩</code>: 要求客户端和服务端同时维护和更新首部字段表并进行Huffman编码压缩, 避免重复传输</li></ul> <h2 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h2> <h3 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h3> <ul><li>将域名翻译为IP地址</li> <li>域名由字母, 数字, 连接符组成, 由点号分割, 从左往右域名级别下降
<ul><li><code>根域名</code>: 空, 即没有限制</li> <li><code>顶级域名</code>: 通用域名(com, net, org), 国家域名(nz, us)</li> <li><code>二级域名</code>: 顶级域名的下一级域名</li></ul></li> <li>基于UDP实现, 端口53</li></ul> <h3 id="域名服务器"><a href="#域名服务器" class="header-anchor">#</a> 域名服务器</h3> <ul><li><code>根域名服务器</code>: 最高层次, 知道所有的顶级域名服务器, 能够告知域名对应的顶级域名服务器</li> <li><code>顶级域名服务器</code>: 管理在该服务器下注册的所有二级域名</li> <li><code>权限域名服务器</code>: 每台主机在域名权限服务器登记, 能将在旗下注册的主机名转为IP</li> <li><code>本地域名服务器</code>: 主机最先发送DNS请求给的服务器</li></ul> <h3 id="dns解析过程"><a href="#dns解析过程" class="header-anchor">#</a> DNS解析过程</h3> <p>本地HOST文件 → 本地域名服务器的缓存 → 根域名服务器 → 顶级域名服务器 → 下级服务器</p> <ul><li><code>递归查询</code>: 本地域名服务器接收到主机的DNS请求后代替完成DNS查询</li> <li><code>迭代查询</code>: 根域名服务器接收到本地域名服务器的DNS请求后返回能完成当前DNS请求的服务器地址</li></ul> <h3 id="dns安全"><a href="#dns安全" class="header-anchor">#</a> DNS安全</h3> <ul><li><code>DNS劫持</code>: 劫持DNS服务器, 获得某域名的解析记录控制权, 修改解析结果</li> <li><code>DNS污染</code>: 入侵检测UDP53端口, 发现匹配DNS查询后, 篡改DNS查询返回记录</li></ul> <h2 id="ip"><a href="#ip" class="header-anchor">#</a> IP</h2> <h3 id="数据包格式"><a href="#数据包格式" class="header-anchor">#</a> 数据包格式</h3> <img src="/camille/basic/network/dev-network-ip-2.jpeg" alt="IP数据报格式"> <ul><li><code>版本</code>: 4代表IPV4, 6代表IPV6</li> <li><code>首部长度</code>: 首部有多少个4字节, 最小值5, 最大值15</li> <li><code>区分服务</code>: 获取更好的服务</li> <li><code>总长度</code>: 当前IP数据包整个长度, 单位字节, 最大值65535字节</li> <li><code>标识</code>: 分片数据包的相同标识</li> <li><code>标志</code>: 第一位为0, 第二位为1表示允许分片/0表示不分片, 第三位为1表示还有分片/0表示最后一个分片</li> <li><code>片偏移</code>: 在分片前的数据位置, 单位为8字节</li> <li><code>生存时间</code>: TTL, 允许的路由跳数</li> <li><code>协议</code>: 传输层使用协议</li> <li><code>首部校验和</code>: 每经过一个路由计算的头部校验</li> <li><code>填充</code>: 使得头部总长度为4字节的倍数</li></ul> <h3 id="ip地址编码"><a href="#ip地址编码" class="header-anchor">#</a> IP地址编码</h3> <ul><li><code>分类</code>: 网络号 + 主机号, 分为A(8位网络号), B(16位网络号), C(24位网络号), D(多播地址), E(保留地址)类地址
<ul><li>主机号至少2bit, 且不能使用全0(本网络的网络地址), 全1(本网络的广播地址)</li></ul></li> <li><code>子网划分</code>: 将主机号部分拿出作为子网号, 使用子网掩码表达</li> <li><code>无分类CIDR</code>: ip地址后面加上网络前缀的比特长度, 网络前缀长度表示连续ip地址的相同部分</li></ul> <h3 id="相关协议"><a href="#相关协议" class="header-anchor">#</a> 相关协议</h3> <p><strong>地址解析协议ARP</strong>:</p> <ul><li>实现由IP地址得到MAC地址</li> <li>每个主机都有ARP缓存, 如果没有相应映射, 则广播发送ARP请求分组得到</li></ul> <p><strong>网际控制报文协议ICMP</strong>:</p> <ul><li>确定IP包成功到达目的地址, 若失败则通知失败原因</li></ul> <h3 id="网络地址转换nat"><a href="#网络地址转换nat" class="header-anchor">#</a> 网络地址转换NAT</h3> <ul><li>有NAT软件的路由器成为NAT路由器, 至少有一个有效地外部IP地址</li> <li>内部主机通过NAT以一个外部IP的身份与外界通信, NAT保存内部IP的通信与外部IP的映射关系表, 使得通信返回时能找到对应内部主机</li></ul> <p><strong>实现方法</strong>:</p> <ul><li><code>静态转换</code>: 私有IP转为公有IP, 一对一, 不变</li> <li><code>动态转换</code>: 私有IP转为公有IP, 对应关系不确定</li> <li><code>端口多路复用</code>: 私有IP共用公有IP, 但是对应不同的端口</li> <li><code>ALG</code>: 应用级别网关技术, 在协议数据报文中包含地址信息</li></ul> <h3 id="ipv6"><a href="#ipv6" class="header-anchor">#</a> IPV6</h3> <ul><li>128bit表示ip地址, 用冒号分割, 连续0位段可以用两个冒号压缩(一个ip地址中只能出现一次双冒号)</li></ul> <p><strong>数据报格式</strong>:</p> <img src="/camille/basic/network/ipv6.webp" alt="IPV6数据报格式"> <ul><li><code>Version</code>: 版本</li> <li><code>Traffic Class</code>: 获得更好的服务</li> <li><code>Flow Label</code>: 标记特殊处理的数据流</li> <li><code>Payload Length</code>: 负载长度, 报文总长度-40, 最大65535字节</li> <li><code>Next Header</code>: 扩展报头类型或传输层协议头</li> <li><code>Hop Limit</code>: 跳转次数限定</li></ul> <h4 id="ipv4过渡方式"><a href="#ipv4过渡方式" class="header-anchor">#</a> IPV4过渡方式</h4> <ul><li><code>双协议栈</code>: 主机与IPV4通信时使用IPV4地址, IPV6同理</li> <li><code>隧道技术</code>: IPV6数据报进入IPV4网络时封装为IPV4数据报, 到达主机时将IPV6数据报交给IPV6协议栈</li></ul> <h2 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h2> <ul><li>传输的数据先打到TCP包中, TCP包再封装到IP包中, 再到以太网的Frame中进行传输, 接受的数据根据各层协议依次解析处理</li></ul> <p><strong>数据包头部格式</strong>:</p> <img src="/camille/basic/network/dev-network-tcpip-1.jpg" alt="TCP数据报头格式"> <ul><li><code>Sequence Number</code>: 序列号, 解决乱序问题</li> <li><code>Acknowledgement Number</code>: ACK, 确认收到</li> <li><code>Offset</code>: 填充位</li> <li><code>Reserved</code>: 保留位</li> <li><code>TCP Flag</code>: 包类型, TCP状态</li> <li><code>Window</code>: 滑动窗口</li> <li><code>CheckSum</code>: 校验和</li> <li><code>Urgent Pointer</code>: 紧急指针, 标识紧急数据</li></ul> <h3 id="三次握手四次挥手"><a href="#三次握手四次挥手" class="header-anchor">#</a> 三次握手四次挥手</h3> <img src="/camille/basic/network/dev-network-tcpip-4.jpg" alt="TCP34" width="60%"> <h3 id="状态机"><a href="#状态机" class="header-anchor">#</a> 状态机</h3> <img src="/camille/basic/network/dev-network-tcpip-3.png" alt="TCP状态机" width="60%"> <h3 id="一些情况"><a href="#一些情况" class="header-anchor">#</a> 一些情况</h3> <ul><li><code>SYN超时</code>: 服务端收到了客户端第一次握手但没收到第三次握手, 服务端处于SYN-RECEIVED, 服务端过一段时间重发SYN+ACK, 每次重试后时间间隔翻倍</li> <li><code>SYN攻击</code>: 大量的请求给服务端发送一个SYN后下线, 占用SYN队列
<ul><li>解决方案(tcp_syncookies参数): SYN队列满后, TCP根据源端口, 目的端口, 时间戳生成一个SYN(SYN Cookie), 从而使得服务端可以通过SYN Cookie建立连接(无需在SYN队列)</li></ul></li> <li><code>ISN(Initial SYN)</code>: 在TCP建立连接的时候, 双方均需要初始化一个随机的SYN, 如果每次初始化相同的SYN, 则两次TCP连接发送的数据包可能会被认为是同一次连接发送的数据包</li> <li><code>MSL(Maximum Segment Lifetime)与TIME_WAIT</code>: <code>MSL</code>为TCP Segment最长存活时间(定义为2min, Linux 30s), TCP从TIME_WAIT到CLOSED需要等待2MSL
<ul><li>目的: 确保有足够的时间对方收到ACK, 如果对方未收到会重发FIN, 恰好2MSL; 防止和后面的连接混淆</li></ul></li> <li><code>TIME_WAIT过多</code>: 因为2MSL的等待时间可能会导致大量的TIME_WAIT
<ul><li>解决方案: (不推荐)设置tcp_tw_reuse和tcp_tw_recycle, tcp_max_tw_buckets(TIME_WAIT最大并发数)</li></ul></li> <li><code>SYN变化</code>: 一次TCP中的SYN的变化与传输字节数有关</li></ul> <h3 id="tcp重传"><a href="#tcp重传" class="header-anchor">#</a> TCP重传</h3> <ul><li><code>超时重传</code>: 接收方不作任何操作, 等待发送方重传</li> <li><code>快速重传</code>: 接收方没有连续到达时, 持续发送ACK, 发送方收到连续3个相同的ACK时重传</li> <li><code>SACK</code>: 在TCP头加一个SACK, 需要双方均开启, 当没有接收到连续数据包时, ACK值保持不变, SACK记录非连续收到的包范围, 当SACK记录变为连续后修改ACK, 删除SACK记录</li> <li><code>D-SACK</code>: ACK覆盖了第一段的SACK或第二段的SACK覆盖了第一段的SACK则说明发生了重复接收, 仅用于提醒发送方</li></ul> <h3 id="rtt"><a href="#rtt" class="header-anchor">#</a> RTT</h3> <p>重传需要有超时时间RTO, 通过计算RTT(数据包的往返时间)得到</p> <p><strong>计算方法</strong>:</p> <ul><li><code>经典算法</code>: 采样RTT, 做平滑计算SRTT(对上次SRTT与RTT加权), 计算RTO(RTO的加权, 且限制上下界)</li> <li><code>Karn/Partridge</code>: 忽略重传的RTT样本</li> <li><code>Jacobson/Karels</code>: 计算SRTT的基础上, 平滑计算DevRTT(DevRTT与|RTT-SRTT|加权), 计算RTO(SRTT和DevRTT加权)</li></ul> <h3 id="tcp滑动窗口"><a href="#tcp滑动窗口" class="header-anchor">#</a> TCP滑动窗口</h3> <ul><li>告诉接收端自己还有多少缓冲区可以接收数据, 发送端据此发送数据</li> <li><code>[已发送已ACK的数据, 滑动窗口结构(已发送未ACK的数据, 未发送的数据), 未读取的数据]</code></li></ul> <h2 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h2> <p><strong>数据报头格式</strong>: 源端口(16bit), 目的端口(16bit), 长度(16bit), 校验和(16bit)</p> <p><strong>特点</strong>:</p> <ul><li><code>无连接</code>: 不需要像TCP那样三次握手建立连接</li> <li><code>首部开销小</code>, <code>无拥塞控制</code>, <code>无可靠交付</code></li> <li><code>面向报文</code>: 报文是UDP数据报处理最小单位</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">2022/9/29 09:52:18</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/camille/basic/theory.html">
        理论
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/camille/assets/js/app.89cf657d.js" defer></script><script src="/camille/assets/js/2.c0d8e570.js" defer></script><script src="/camille/assets/js/1.b1971c90.js" defer></script><script src="/camille/assets/js/26.a28b8735.js" defer></script>
  </body>
</html>
