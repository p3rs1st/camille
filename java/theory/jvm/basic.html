<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>理论基础 | Never See</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="不见">
    
    <link rel="preload" href="/camille/assets/css/0.styles.ac02bd7f.css" as="style"><link rel="preload" href="/camille/assets/js/app.89cf657d.js" as="script"><link rel="preload" href="/camille/assets/js/2.c0d8e570.js" as="script"><link rel="preload" href="/camille/assets/js/1.b1971c90.js" as="script"><link rel="preload" href="/camille/assets/js/37.36129612.js" as="script"><link rel="prefetch" href="/camille/assets/js/10.655a1089.js"><link rel="prefetch" href="/camille/assets/js/11.e879aba2.js"><link rel="prefetch" href="/camille/assets/js/12.3d71d70f.js"><link rel="prefetch" href="/camille/assets/js/13.b40e96b9.js"><link rel="prefetch" href="/camille/assets/js/14.a15c23f8.js"><link rel="prefetch" href="/camille/assets/js/15.086621a3.js"><link rel="prefetch" href="/camille/assets/js/16.38ad00d8.js"><link rel="prefetch" href="/camille/assets/js/17.7d9f6541.js"><link rel="prefetch" href="/camille/assets/js/18.58f20acb.js"><link rel="prefetch" href="/camille/assets/js/19.cf2cf075.js"><link rel="prefetch" href="/camille/assets/js/20.f36b6fbb.js"><link rel="prefetch" href="/camille/assets/js/21.d1e109e6.js"><link rel="prefetch" href="/camille/assets/js/22.e5e7d61e.js"><link rel="prefetch" href="/camille/assets/js/23.c0b72d40.js"><link rel="prefetch" href="/camille/assets/js/24.24755f5b.js"><link rel="prefetch" href="/camille/assets/js/25.e79f3b27.js"><link rel="prefetch" href="/camille/assets/js/26.a28b8735.js"><link rel="prefetch" href="/camille/assets/js/27.2019210c.js"><link rel="prefetch" href="/camille/assets/js/28.195e9507.js"><link rel="prefetch" href="/camille/assets/js/29.da9a1b36.js"><link rel="prefetch" href="/camille/assets/js/3.c9a6670a.js"><link rel="prefetch" href="/camille/assets/js/30.7e78e35a.js"><link rel="prefetch" href="/camille/assets/js/31.742a34b1.js"><link rel="prefetch" href="/camille/assets/js/32.c69a703e.js"><link rel="prefetch" href="/camille/assets/js/33.9a798fe0.js"><link rel="prefetch" href="/camille/assets/js/34.09ed62b4.js"><link rel="prefetch" href="/camille/assets/js/35.40c45f3a.js"><link rel="prefetch" href="/camille/assets/js/36.30460db4.js"><link rel="prefetch" href="/camille/assets/js/38.84775c59.js"><link rel="prefetch" href="/camille/assets/js/39.233eb667.js"><link rel="prefetch" href="/camille/assets/js/4.51108671.js"><link rel="prefetch" href="/camille/assets/js/40.665ccab0.js"><link rel="prefetch" href="/camille/assets/js/41.8f5e492c.js"><link rel="prefetch" href="/camille/assets/js/42.bc9f0e34.js"><link rel="prefetch" href="/camille/assets/js/43.203e2859.js"><link rel="prefetch" href="/camille/assets/js/44.d6e345f5.js"><link rel="prefetch" href="/camille/assets/js/5.c5132282.js"><link rel="prefetch" href="/camille/assets/js/6.89d8cb10.js"><link rel="prefetch" href="/camille/assets/js/7.ee093510.js"><link rel="prefetch" href="/camille/assets/js/vendors~docsearch.3d49b2ab.js">
    <link rel="stylesheet" href="/camille/assets/css/0.styles.ac02bd7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/camille/" class="home-link router-link-active"><!----> <span class="site-name">Never See</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/camille/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/camille/always/network.html" class="nav-link">
  常用表
</a></div><div class="nav-item"><a href="/camille/basic/network.html" class="nav-link">
  基础知识
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          理论知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/theory/basic/basic.html" class="nav-link">
  基础理论
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/multi_process/basic.html" class="nav-link">
  多进程
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/jvm/basic.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringBoot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/springboot/bug.html" class="nav-link">
  bugs
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/framework/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/camille/framework/dubbo/" class="nav-link">
  Dubbo
</a></li></ul></div></div><div class="nav-item"><a href="/camille/unorganized/" class="nav-link">
  待整理
</a></div><div class="nav-item"><a href="/camille/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/camille/system/" class="nav-link">
  系统安装
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/camille/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/camille/always/network.html" class="nav-link">
  常用表
</a></div><div class="nav-item"><a href="/camille/basic/network.html" class="nav-link">
  基础知识
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          理论知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/theory/basic/basic.html" class="nav-link">
  基础理论
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/multi_process/basic.html" class="nav-link">
  多进程
</a></li><li class="dropdown-subitem"><a href="/camille/java/theory/jvm/basic.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringBoot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/camille/java/springboot/bug.html" class="nav-link">
  bugs
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/camille/framework/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/camille/framework/dubbo/" class="nav-link">
  Dubbo
</a></li></ul></div></div><div class="nav-item"><a href="/camille/unorganized/" class="nav-link">
  待整理
</a></div><div class="nav-item"><a href="/camille/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/camille/system/" class="nav-link">
  系统安装
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础理论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/camille/java/theory/basic/basic.html" class="sidebar-link">基础</a></li><li><a href="/camille/java/theory/basic/mechanism.html" class="sidebar-link">机制</a></li><li><a href="/camille/java/theory/basic/collection.html" class="sidebar-link">集合框架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>多线程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/camille/java/theory/multi_process/basic.html" class="sidebar-link">理论基础</a></li><li><a href="/camille/java/theory/multi_process/javalib.html" class="sidebar-link">java库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/camille/java/theory/jvm/basic.html" aria-current="page" class="active sidebar-link">理论基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/camille/java/theory/jvm/basic.html#jvm整体架构" class="sidebar-link">JVM整体架构</a></li><li class="sidebar-sub-header"><a href="/camille/java/theory/jvm/basic.html#类字节码" class="sidebar-link">类字节码</a></li><li class="sidebar-sub-header"><a href="/camille/java/theory/jvm/basic.html#jmm-java-memory-model" class="sidebar-link">JMM(Java Memory Model)</a></li><li class="sidebar-sub-header"><a href="/camille/java/theory/jvm/basic.html#类加载机制" class="sidebar-link">类加载机制</a></li></ul></li><li><a href="/camille/java/theory/jvm/gc.html" class="sidebar-link">GC</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="理论基础"><a href="#理论基础" class="header-anchor">#</a> 理论基础</h1> <p></p><div class="table-of-contents"><ul><li><a href="#jvm整体架构">JVM整体架构</a></li><li><a href="#类字节码">类字节码</a></li><li><a href="#jmm-java-memory-model">JMM(Java Memory Model)</a><ul><li><a href="#程序计数器">程序计数器</a></li><li><a href="#虚拟机栈">虚拟机栈</a></li><li><a href="#本地方法栈">本地方法栈</a></li><li><a href="#堆">堆</a></li><li><a href="#方法区">方法区</a></li></ul></li><li><a href="#类加载机制">类加载机制</a><ul><li><a href="#类加载过程">类加载过程</a></li><li><a href="#类加载器">类加载器</a></li><li><a href="#jvm类加载机制">JVM类加载机制</a></li></ul></li></ul></div><p></p> <h2 id="jvm整体架构"><a href="#jvm整体架构" class="header-anchor">#</a> JVM整体架构</h2> <img src="/camille/java/JVM.png" alt="JVM"> <h2 id="类字节码"><a href="#类字节码" class="header-anchor">#</a> 类字节码</h2> <p>class文件是以8字节为单位的二进制流, java文件编译为class文件后, 可以被jvm识别以及运行</p> <p><strong>文件结构</strong>:</p> <img src="/camille/java/java-jvm-class-2.png" alt="java-jvm-class-2"> <h2 id="jmm-java-memory-model"><a href="#jmm-java-memory-model" class="header-anchor">#</a> JMM(Java Memory Model)</h2> <ul><li><code>线程私有</code>: 程序计数器, 虚拟机栈, 本地方法区</li> <li><code>线程共享</code>: 堆, 方法区, 堆外内存(java7永久代, java8元空间)</li></ul> <h3 id="程序计数器"><a href="#程序计数器" class="header-anchor">#</a> 程序计数器</h3> <blockquote><p>线程私有的, 记录线程运行到的字节码指令地址</p></blockquote> <h3 id="虚拟机栈"><a href="#虚拟机栈" class="header-anchor">#</a> 虚拟机栈</h3> <blockquote><p>保存方法的局部变量, 部分结果, 方法的调用和返回</p></blockquote> <ul><li>大小是动态或固定不变的
<ul><li><code>固定不变</code>: 在有线程请求分配栈容量超过最大容量时, 抛出<code>StackOverflowError</code></li> <li><code>动态</code>: 尝试扩展时无法申请足够内存, 或新线程无法申请足够内存, 抛出<code>OutOfMemoryError</code></li></ul></li> <li><code>-Xss</code>设置栈空间大小</li> <li>每个线程有自己的栈, 以栈帧格式存在, 正在运行的方法对应一个栈帧, 栈帧包含以下数据
<ul><li><code>局部变量表</code>: 在编译器确定大小</li> <li><code>操作数栈</code>: 保存计算的中间结果</li> <li><code>动态链接</code>: 将符号引用转为调用方法的直接引用</li> <li><code>方法返回地址</code>: 存放调用该方法的PC值</li></ul></li></ul> <h3 id="本地方法栈"><a href="#本地方法栈" class="header-anchor">#</a> 本地方法栈</h3> <ul><li>与其他语言交互</li> <li>与操作系统交互</li> <li>在HotSpot中本地方法栈和虚拟机栈合二为一</li></ul> <h3 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h3> <ul><li>存放对象实例, 逻辑上分为三代(分代理由为优化gc性能), 新生代, 老年代, 元空间
<ul><li><code>新生代</code>: 新对象, 使用次数较少, 使用<code>Minor GC</code>, 分为<code>Eden:From Survivor:To Survivor=8:1:1</code>.
<ol><li>新对象在<code>Eden</code>创建</li> <li><code>Minor GC</code>时将<code>Eden</code>和<code>From Survivor</code>中存活对象复制到<code>To Survivor</code></li> <li>清空<code>Eden</code>和<code>From Survivor</code></li> <li>交换<code>From Survivor</code>和<code>To Survivor</code></li> <li>存活一定次数后的对象移动到老年代</li></ol></li> <li><code>老年代</code>: 使用次数较多的对象或大对象, 使用<code>Major GC</code></li></ul></li> <li><code>-Xmx</code>设置最大堆内存(默认<code>电脑内存/4</code>)和<code>-Xms</code>设置堆起始内存(默认<code>电脑内存/64</code>), 堆大小超过<code>-Xmx</code>抛出<code>OutOfMemoryError</code></li> <li><code>Mixed GC</code>: 整个新生代和部分老年代的<code>GC</code>, <code>Full GC</code>: 整个java堆和方法区的<code>GC</code></li> <li><code>TLAB</code>(Thread Local Allocation Buffer): 对<code>Eden</code>划分, 每个线程有一个私有缓存区, 避免部分线程安全问题</li></ul> <h4 id="逃逸分析"><a href="#逃逸分析" class="header-anchor">#</a> 逃逸分析</h4> <blockquote><p>分析一个对象的引用的使用范围从而决定是否将对象分配到堆上</p> <p>方法中定义且只在方法中使用不会逃逸, 方法中定义但被外部方法引用(如作为返回值)则会逃逸</p></blockquote> <ol><li><code>同步省略</code>: 非逃逸对象只能被一个线程访问, 则取消同步代码</li> <li><code>标量替换</code>: 非逃逸对象无需连续内存, 可以仅保存对象的部分字段, 存储在CPU寄存器中</li> <li><code>栈上分配</code>: 非逃逸对象由堆分配转为栈分配</li></ol> <h3 id="方法区"><a href="#方法区" class="header-anchor">#</a> 方法区</h3> <blockquote><p>存储类信息、常量池、静态变量、JIT编译后的代码等数据</p></blockquote> <ul><li>永久代和元空间是方法区的具体实现, 永久代是堆的一部分, 元空间存在本地内存(堆外内存)</li> <li>移除永久代原因(仅HotSpot中有): 永久代设置空间大小难确定, 永久代调优困难</li> <li>垃圾回收: 常量池中废弃的常量和不再使用的类型</li></ul> <h2 id="类加载机制"><a href="#类加载机制" class="header-anchor">#</a> 类加载机制</h2> <h3 id="类加载过程"><a href="#类加载过程" class="header-anchor">#</a> 类加载过程</h3> <ul><li><code>加载</code>: 通过类的全限定名获取二进制字节流, 将其中表示的静态结构转为方法区的运行时数据结构, 在堆中生成一个代表该类的java.lang.Class对象作为对方法区这些数据的访问入口</li> <li><code>验证</code>: 确保被加载的类的正确性, 包括文件格式验证, 元数据验证, 字节码验证, 符号引用验证</li> <li><code>准备</code>: 在方法区为静态变量分配内存并初始化为默认值</li> <li><code>解析</code>: 将符号引用转为直接引用</li> <li><code>初始化</code>: 变量初始值以及静态代码块</li></ul> <h3 id="类加载器"><a href="#类加载器" class="header-anchor">#</a> 类加载器</h3> <ul><li><code>启动类加载器</code>: JVM自身需要的类, 由C++实现</li> <li><code>扩展类加载器</code>: Sun公司用Java实现的类, 开发者可用</li> <li><code>应用程序类加载器</code>: 加载用户类路径所指定的类, 未自定义自己的类加载器的应用程序使用的类加载器</li> <li><code>自定义类加载器</code>: 用户编写的类加载器</li></ul> <h4 id="类加载实现"><a href="#类加载实现" class="header-anchor">#</a> 类加载实现</h4> <ul><li><code>Class.forName()</code>: 将class文件加载到JVM, 并解释类, 执行static块, 带参数的版本可控制是否执行static块</li> <li><code>ClassLoader.loadClass()</code>: 仅将class文件加载到JVM, 不执行static块</li></ul> <h3 id="jvm类加载机制"><a href="#jvm类加载机制" class="header-anchor">#</a> JVM类加载机制</h3> <ul><li><code>全盘负责</code>: 加载某个Class时其所有依赖Class均由该类加载器加载</li> <li><code>父类委托</code>: 让父类加载器尝试加载, 无法加载时从自己的类路径加载</li> <li><code>缓存机制</code>: 加载过的Class被缓存, 不存在缓存区的Class才会加载并转化为Class对象存入缓存区</li> <li><code>双亲委派机制</code>: 收到类加载请求时先委托父类加载器, 然后继续委托父类的父类加载器, 直到顶层, 当父类加载器无法加载才会让子类加载器加载
<ul><li>优势: 防止内存出现相同的字节码, 保证java程序安全稳定运行</li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">2022/11/1 10:20:27</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/camille/java/theory/multi_process/javalib.html" class="prev">
        java库
      </a></span> <span class="next"><a href="/camille/java/theory/jvm/gc.html">
        GC
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/camille/assets/js/app.89cf657d.js" defer></script><script src="/camille/assets/js/2.c0d8e570.js" defer></script><script src="/camille/assets/js/1.b1971c90.js" defer></script><script src="/camille/assets/js/37.36129612.js" defer></script>
  </body>
</html>
